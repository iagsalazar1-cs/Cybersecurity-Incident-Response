# One of Us - TDX Arena Certification Report

### Executive Summary

This project involved a cybersecurity challenge focused on identifying a malicious file and its hash signature on a compromised client system. I began by examining a directory on the Desktop filled with numerous suspicious executable files. Recognizing the limitations of the **ClamAV** web UI for bulk scanning, I opted for using an `AI` generated Python script to automate the scanning of all files and save their results. Another script was then used to analyze these results. This process successfully identified `file176.exe` as the malicious artifact and the extraction of its `MD5` hash signature, completing the primary objectives of the challenge.

### Findings and Analysis

| Finding | Finding Details | Description |
| :--- | :--- | :--- |
| **Directory** | `suspicious-files` | A directory found at Desktop, containing numerous potentially malicious `.exe` file artifacts. |
| **File** | `file176.exe.json` | Scan results of the infected file generated by a scan script, including its name, size, and hash. |
| **File** | `file176.exe` | The singular infected file identified in the `suspicious-files` directory. |
| **Hash** | MD5 `f48a8687e91fd9ef98cd1b7aaeeb2a4c` | `file176.exe` hash obtained from automated scan results. |

### Methodology

#### Tools and Technologies Used

* **ClamAV Web UI:** The primary web application for antivirus scanning.
* **Python 3:** The programming language used for scripting.
* `scan_script.py`: Custom Python script used to automate file scanning.
* `find_infected.py`: Custom Python script used to analyze scan results and identify infected files.
* `curl`: Command-line tool used for transferring data with URLs, specifically for API authentication.
* `nano`: Text editor used in the terminal to create and modify Python scripts.
* **VirusTotal:** Online service for analyzing suspicious files and URLs, providing multiple antivirus engine detections.

#### Investigation Process

1.  **Environment Reconnaissance:** The `suspicious-files` directory was found with 272 `.exe` files, indicating potential malicious artifacts.

    ![Figure 1 - Malicious-Files Directory](https://github.com/iagsalazar1-cs/Cybersecurity-Incident-Response/blob/main/01-One-of-Us/images/Figure01_Malicious_Files_Directory.png)

2.  **ClamAV UI Exploration:** Explored the **ClamAV** web UI noting its individual file scanning, but observing the lack of a built-in feature for scanning an entire directory.

    ![Figure 2 - ClamAV UI Single File Scan](https://github.com/iagsalazar1-cs/Cybersecurity-Incident-Response/blob/main/01-One-of-Us/images/Figure02_ClamAV_UI_Single_File_Scan.png)

3.  **Local ClamAV Attempt:** Failed to scan the `suspicious-files` directory with `clamscan` (not found). Installation attempts also failed due to insufficient privileges.

    ![Figure 3 - clamscan utility scan attempt](https://github.com/iagsalazar1-cs/Cybersecurity-Incident-Response/blob/main/01-One-of-Us/images/Figure03_clamscan_utility_scan_attempt.png)

4.  **ClamAV API Documentation Review:** Noted the `JWT` token requirement for secure authentication and file scanning, which serves as a credential for data transfer over the web.

    ![Figure 4 - ClamAV Application Programming Interface Documentation Review](https://github.com/iagsalazar1-cs/Cybersecurity-Incident-Response/blob/main/01-One-of-Us/images/Figure04_ClamAV_API_Documentation.png)

5.  **Token Acquisition:** Successfully obtained **ClamAV's** authentication token using `curl`, bypassing an `SSL` certificate verification issue.

    ![Figure 5 - Token Acquisition](https://github.com/iagsalazar1-cs/Cybersecurity-Incident-Response/blob/main/01-One-of-Us/images/Figure05_Token_Acquisition.png)

6.  **Python Environment Setup:** Confirmed the availability of Python 3 and `pip3` on the system. Installed the `requests` library to enable `HTTP` Python scripts requests.

    ![Figure 6 - Python Environment Setup](https://github.com/iagsalazar1-cs/Cybersecurity-Incident-Response/blob/main/01-One-of-Us/images/Figure06_Python_Environment_Setup.png)

7.  **Automated Scanning Script (`scan_script.py`):** Created and saved a Python script on the Desktop. The executed script parsed through all files in the `suspicious-files` directory and saved results to a new directory.

    ![Figure 7 - scan_script.py Python Script Execution](https://github.com/iagsalazar1-cs/Cybersecurity-Incident-Response/blob/main/01-One-of-Us/images/Figure07_scan_script_py_Script_Execution.png)

    ![Figure 8 - scan_script.py](https://github.com/iagsalazar1-cs/Cybersecurity-Incident-Response/blob/main/01-One-of-Us/images/Figure08_scan_script_py.png)

8.  **Scanning Script Verification of Results:** Verified `scan_results` directory populated with individual result files, confirming successful automated scanning.

    ![Figure 9 - scan_results Directory Verification](https://github.com/iagsalazar1-cs/Cybersecurity-Incident-Response/blob/main/01-One-of-Us/images/Figure09_scan_results_Directory_Verification.png)

9.  **Scan Result Analysis (`find_infected.py`):** Created a second Python script to iterate and parse files in the `scan_results` directory to identify the infected file. Executed the script, identifying `file176.exe` as infected.

    ![Figure 10 - Scan Result Analysis Script Execution](https://github.com/iagsalazar1-cs/Cybersecurity-Incident-Response/blob/main/01-One-of-Us/images/Figure10_Scan_Result_Analysis_Script_Execution.png)

    ![Figure 11 - find_infected.py](https://github.com/iagsalazar1-cs/Cybersecurity-Incident-Response/blob/main/01-One-of-Us/images/Figure11_find_infected_py.png)

10. **Hash Signature Retrieval:** Examined the scan report in `file176.exe.json` for the malicious file and extracted its `MD5` hash.

    ![Figure 12 - Hash Signature Retrieval](https://github.com/iagsalazar1-cs/Cybersecurity-Incident-Response/blob/main/01-One-of-Us/images/Figure12_Hash_Signature_Retrieval.png)

11. **VirusTotal Analysis:** Uploaded `file176.exe` to **VirusTotal**, which confirmed it as `shikataganai Trojan Malware` and malicious (6/63 vendors flagging it).

    ![Figure 13 - VirusTotal Analysis of file176.exe](https://github.com/iagsalazar1-cs/Cybersecurity-Incident-Response/blob/main/01-One-of-Us/images/Figure13_VirusTotal_Analysis.png)

    ![Figure 14 - VirusTotal Details Section of file176.exe Analysis](https://github.com/iagsalazar1-cs/Cybersecurity-Incident-Response/blob/main/01-One-of-Us/images/Figure14_VirusTotal_Details.png)

### Recommendations

1.  **Implement Robust Endpoint Security:** Deploy and maintain up-to-date antivirus (`AV`) and **Endpoint Detection and Response (EDR)** solutions across all systems, configured for real-time scanning and behavioral analysis to detect and block malware like `trojan.shikataganai`.
2.  **Regular System and Network Scans:** Schedule regular, comprehensive scans of all endpoints and network segments.
3.  **Automated Threat Intelligence Integration:** Integrate security tools with threat intelligence feeds (e.g., **VirusTotal**) for automated file hash checking.

### Appendix A: Detailed Findings

#### File-related Findings

| Item | Details | Path | Contents | MD5 Hash |
| :--- | :--- | :--- | :--- | :--- |
| **Directory** | `suspicious-files` | `/home/bruce/Desktop/suspicious-files` | 272 executable (`.exe`) artifacts. | N/A |
| **File** | `file176.exe.json` | `/home/bruce/Desktop/scan_results/file176.exe.json` | Scan results of `file176.exe` indicating infected status and hash. | N/A |
| **File** | `file176.exe` | `/home/bruce/Desktop/suspicious-files/file176.exe` | N/A | `f48a8687e91fd9ef98cd1b7aaeeb2a4c` |

### Appendix B: VirusTotal Details Section

| Attribute | Value |
| :--- | :--- |
| **Malicious File** | `file176.exe` |
| **File Size** | `223.19 KB` |
| **MD5 Hash** | `f48a8687e91fd9ef98cd1b7aaeeb2a4c` |
| **SHA-1 Hash** | `8e014393c8d424e28fc4b71f88d237639ca82ff1` |
| **First Submission Date** | `2022-01-14 07:29:12 UTC` |
| **Malware Type** | `Trojan` from the `shikataganai` family |
| **Detection Ratio** | `6 / 63` security vendors flagged as malicious |
| **SHA-256 Hash** | `1b7252aa6d8e4717655de3e5edcf25838c5839c4946c521f934be0f0ceb0` |
| **File Type** | `DOS` executable, `MZ` executable |
| **Magic** | `Win64/16/32 Executable`, `Windows Icons Library`, `OS/2 Executable` |
| **Last Analysis Date** | `2025-05-21 04:04:59 UTC` |

### Appendix C: Command History

| Syntax | Description |
| :--- | :--- |
| `ls` | Used to list directory contents (used throughout the lab). |
| `clamscan suspicious-files/` | **ClamAV** command-line antivirus scanner used to scan the `suspicious-files` directory. |
| `sudo apt update` | Allows you to run commands with the security privileges of the root user (`sudo`), used to retrieve the latest package information (`apt update`) from the system. |
| `curl https://clamav-ui.com/api/v1/auth` | Used to transfer data to or from a server from the specified URL. |
| `curl -k https://clamav-ui.com/api/v1/auth` | Used to transfer data to or from a server from the specified URL with the option disable `SSL` certificate verification (`-k`). |
| `Python3` | Used to invoke the Python 3 interpreter. |
| `pip3 --version` | Package installer for Python 3 with the option to output its version number (`--version`). |
| `pip3 install requests --user` | Installs the `requests` Python library for Python 3 for the current user without needing administrative rights. Needed to execute python scripts in the lab environment. |
| `nano scan_script.py` | Used to create a new file named `scan_script.py` in the `nano` text editor. |
| `python3 scan_script.py` | Executes the Python 3 script named `scan_script.py`. |
| `nano find_infected.py` | Used to create a new file named `find_infected.py` in the `nano` text editor. |
| `python3 find_infected.py` | Executes the Python 3 script named `find_infected.py`. |
| `cat scan_results/file176.exe.json` | Displays the content of the `file176.exe.json` file located in the `scan_results` directory on the terminal. |

### Appendix D: `scan_script.py`

```python
import requests
import os
import json

base_url = "[https://clamav-ui.com](https://clamav-ui.com)"
verify_ssl = False
token = None
results_dir = "scan_results"

if not os.path.exists(results_dir): # Create the results directory if it doesn't exist
    os.makedirs(results_dir)

auth_url = f"{base_url}/api/v1/auth" # 1. Get the authentication token
try:
    response = requests.get(auth_url, verify=verify_ssl)
    response.raise_for_status()

    token_data = response.json()
    token = token_data['data']['token']
    print(f"Successfully obtained token.")
except requests.exceptions.RequestException as e:
    print(f"Error getting token: {e}")
    exit()
except (KeyError, ValueError) as e:
    print(f"Error parsing token response: {e}")
    exit()

scan_url = f"{base_url}/api/v1/scan" # 2. Scan all files in the suspicious-files directory
headers = {"Authorization": token}
files_dir = "suspicious-files"

for filename in os.listdir(files_dir):
    filepath = os.path.join(files_dir, filename)
    if os.path.isfile(filepath):
        try:
            with open(filepath, 'rb') as f:
                file_to_scan = {'fileinput': (filename, f)}
                response = requests.post(scan_url, headers=headers, files=file_to_scan, verify=verify_ssl)
                response.raise_for_status()
                scan_results = response.json()
                result_filename = os.path.join(results_dir, f"{filename}.json")
                with open(result_filename, 'w') as outfile:
                    json.dump(scan_results, outfile, indent=4)
                print(f"Scan results for {filename} saved to {result_filename}")
                if scan_results.get('data') and scan_results['data'].get('infected'):
                    print(f"*** MALWARE DETECTED in {filename} ***")
                    malicious_file = filename
        except requests.exceptions.RequestException as e:
            print(f"Error scanning {filename}: {e}")
        except ValueError as e:
            print(f"Error parsing scan response for {filename}: {e}")
print("Scanning complete. Results saved to the 'scan_results' directory.")
```

### Appendix E: `find_infected.py`

```Python

import os
import json

results_dir = "scan_results"

for filename in os.listdir(results_dir):
    if filename.endswith(".json"):
        filepath = os.path.join(results_dir, filename)
        try:
            with open(filepath, 'r') as f:
                data = json.load(f)
                if data.get('data') and data['data'].get('files'):
                    for file_info in data['data']['files']:
                        if file_info.get('infected'):
                            print(f"Infected file found: {file_info['fileName']}")
                            infected_filename = file_info['fileName']
                            # We can break here since we only expect one infected file
                            break
                    else:
                        continue # Only executed if the inner loop did NOT break
                    break # Break the outer loop as well
        except (FileNotFoundError, json.JSONDecodeError) as e:
            print(f"Error reading/parsing {filename}: {e}")
print("Finished checking scan results.")
```
